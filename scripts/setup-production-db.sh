#!/bin/bash

echo "ğŸ—„ï¸ Production Database Setup Guide"
echo "=================================="
echo ""

echo "ğŸ“‹ Step-by-Step Instructions:"
echo ""

echo "1ï¸âƒ£ Create Vercel Postgres Databases:"
echo "   â†’ Go to: https://vercel.com/dashboard"
echo "   â†’ Select your DateKeeper project"
echo "   â†’ Go to Storage tab"
echo "   â†’ Create Database â†’ PostgreSQL"
echo ""
echo "   Create TWO databases:"
echo "   ğŸ“Š Staging: 'datekeeper-staging'"
echo "   ğŸš€ Production: 'datekeeper-production'"
echo ""

echo "2ï¸âƒ£ Get Connection Strings:"
echo "   â†’ After creating each database, copy the POSTGRES_PRISMA_URL"
echo "   â†’ This is optimized for Prisma and includes connection pooling"
echo ""

echo "3ï¸âƒ£ Add to GitHub Environment Secrets:"
echo "   â†’ Go to: https://github.com/shaibs3/DateKeeper/settings/environments"
echo ""
echo "   For STAGING environment:"
echo "   â†’ Environment secrets â†’ Add secret"
echo "   â†’ Name: DATABASE_URL"
echo "   â†’ Value: [Your staging POSTGRES_PRISMA_URL]"
echo ""
echo "   For PRODUCTION environment:"
echo "   â†’ Environment secrets â†’ Add secret"
echo "   â†’ Name: DATABASE_URL" 
echo "   â†’ Value: [Your production POSTGRES_PRISMA_URL]"
echo ""

echo "4ï¸âƒ£ Test Database Connection (Optional):"
echo "   â†’ Set DATABASE_URL in your local .env.local"
echo "   â†’ Run: npx prisma db pull"
echo "   â†’ This will test the connection"
echo ""

echo "5ï¸âƒ£ Deploy and Test:"
echo "   â†’ Push to main branch"
echo "   â†’ Deployment will run database migrations automatically"
echo "   â†’ Check deployment logs for success"
echo ""

echo "ğŸ”§ Troubleshooting:"
echo "   â†’ If migrations fail: Check DATABASE_URL format"
echo "   â†’ If connection fails: Verify database is running"
echo "   â†’ If permissions fail: Check database user permissions"
echo ""

echo "ğŸ“š Database URLs Format:"
echo "   POSTGRES_PRISMA_URL format:"
echo "   postgresql://username:password@host:5432/database?pgbouncer=true&connect_timeout=15"
echo ""

echo "âœ… Once complete, your production app will have:"
echo "   â†’ Working database connections"
echo "   â†’ Automatic migrations on deployment"
echo "   â†’ Health endpoints returning 200 (if re-enabled)"
echo "   â†’ Full authentication and data persistence"
echo ""

echo "ğŸš€ Ready to set up your production database!"
