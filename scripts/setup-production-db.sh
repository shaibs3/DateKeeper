#!/bin/bash

echo "ğŸ—„ï¸ Production Database Setup Guide (Neon PostgreSQL)"
echo "===================================================="
echo ""

echo "ğŸ“‹ Step-by-Step Instructions:"
echo ""

echo "1ï¸âƒ£ Create Neon PostgreSQL Databases:"
echo "   â†’ Go to: https://console.neon.tech"
echo "   â†’ Sign in to your Neon account"
echo "   â†’ Create Project or use existing project"
echo ""
echo "   Create TWO databases:"
echo "   ğŸ“Š Staging: Create branch 'staging' or separate project"
echo "   ğŸš€ Production: Use 'main' branch or create 'production' project"
echo ""

echo "2ï¸âƒ£ Get Connection Strings:"
echo "   â†’ In Neon Console, go to your project"
echo "   â†’ Click 'Connection Details' or 'Connect'"
echo "   â†’ Copy the connection string (Prisma format preferred)"
echo "   â†’ Connection string format: postgresql://username:password@host/database?sslmode=require"
echo ""

echo "3ï¸âƒ£ Add Environment Variables to Vercel:"
echo "   â†’ Go to: https://vercel.com/dashboard"
echo "   â†’ Select your DateKeeper project"
echo "   â†’ Settings â†’ Environment Variables"
echo ""
echo "   Add these variables for PRODUCTION:"
echo "   â†’ DATABASE_URL: [Your production Neon connection string]"
echo "   â†’ NEXTAUTH_SECRET: [Strong random secret for production]"
echo "   â†’ NEXTAUTH_URL: https://datekeeper.vercel.app"
echo "   â†’ GOOGLE_CLIENT_ID: [Your production Google OAuth client ID]"
echo "   â†’ GOOGLE_CLIENT_SECRET: [Your production Google OAuth secret]"
echo "   â†’ APP_ENV: production"
echo ""
echo "   Add these variables for PREVIEW (staging):"
echo "   â†’ DATABASE_URL: [Your staging Neon connection string]"
echo "   â†’ NEXTAUTH_SECRET: [Different random secret for staging]"
echo "   â†’ NEXTAUTH_URL: https://datekeeper-staging.vercel.app"
echo "   â†’ GOOGLE_CLIENT_ID: [Your staging Google OAuth client ID]"
echo "   â†’ GOOGLE_CLIENT_SECRET: [Your staging Google OAuth secret]"
echo "   â†’ APP_ENV: staging"
echo ""

echo "4ï¸âƒ£ Generate Secrets:"
echo "   â†’ NEXTAUTH_SECRET: Use a strong random string (32+ characters)"
echo "   â†’ Generate with: openssl rand -base64 32"
echo "   â†’ Or use: https://generate-secret.vercel.app/32"
echo ""

echo "5ï¸âƒ£ Test Database Connection (Optional):"
echo "   â†’ Set DATABASE_URL in your local .env.local"
echo "   â†’ Run: npx prisma db pull"
echo "   â†’ This will test the connection and sync your schema"
echo ""

echo "6ï¸âƒ£ Deploy and Test:"
echo "   â†’ Push to main branch"
echo "   â†’ Deployment will run database migrations automatically"
echo "   â†’ Your app will have access to all environment variables"
echo "   â†’ Check deployment logs for success"
echo ""

echo "ğŸ”§ Troubleshooting:"
echo "   â†’ If migrations fail: Check DATABASE_URL format and SSL settings"
echo "   â†’ If connection fails: Verify Neon database is active (not suspended)"
echo "   â†’ If SSL errors: Ensure ?sslmode=require is in connection string"
echo "   â†’ If timeout: Neon databases auto-suspend, first query may be slower"
echo ""

echo "ğŸ“š Neon Connection String Format:"
echo "   Standard format:"
echo "   postgresql://username:password@ep-xxx-xxx.region.aws.neon.tech/database?sslmode=require"
echo ""
echo "   With connection pooling (recommended for production):"
echo "   postgresql://username:password@ep-xxx-xxx-pooler.region.aws.neon.tech/database?sslmode=require"
echo ""

echo "ğŸŒŸ Neon PostgreSQL Benefits:"
echo "   â†’ Serverless: Auto-scaling and auto-suspend"
echo "   â†’ Branching: Database branches like Git branches"
echo "   â†’ Fast: Sub-second cold starts"
echo "   â†’ Cost-effective: Pay only for what you use"
echo "   â†’ Prisma optimized: Built for modern development"
echo ""

echo "âœ… Once complete, your production app will have:"
echo "   â†’ Working Neon PostgreSQL connections"
echo "   â†’ Automatic migrations on deployment"
echo "   â†’ Serverless database scaling"
echo "   â†’ Full authentication and data persistence"
echo "   â†’ Database branching for staging/production"
echo ""

echo "ğŸš€ Ready to set up your Neon production database!"
