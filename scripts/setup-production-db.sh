#!/bin/bash

echo "ğŸ—„ï¸ Production Database Setup Guide (Neon PostgreSQL)"
echo "===================================================="
echo ""

echo "ğŸ“‹ Step-by-Step Instructions:"
echo ""

echo "1ï¸âƒ£ Create Neon PostgreSQL Databases:"
echo "   â†’ Go to: https://console.neon.tech"
echo "   â†’ Sign in to your Neon account"
echo "   â†’ Create Project or use existing project"
echo ""
echo "   Create TWO databases:"
echo "   ğŸ“Š Staging: Create branch 'staging' or separate project"
echo "   ğŸš€ Production: Use 'main' branch or create 'production' project"
echo ""

echo "2ï¸âƒ£ Get Connection Strings:"
echo "   â†’ In Neon Console, go to your project"
echo "   â†’ Click 'Connection Details' or 'Connect'"
echo "   â†’ Copy the connection string (Prisma format preferred)"
echo "   â†’ Connection string format: postgresql://username:password@host/database?sslmode=require"
echo ""

echo "3ï¸âƒ£ Add to GitHub Environment Secrets:"
echo "   â†’ Go to: https://github.com/shaibs3/DateKeeper/settings/environments"
echo ""
echo "   For STAGING environment:"
echo "   â†’ Environment secrets â†’ Add secret"
echo "   â†’ Name: DATABASE_URL"
echo "   â†’ Value: [Your staging Neon connection string]"
echo ""
echo "   For PRODUCTION environment:"
echo "   â†’ Environment secrets â†’ Add secret"
echo "   â†’ Name: DATABASE_URL" 
echo "   â†’ Value: [Your production Neon connection string]"
echo ""

echo "4ï¸âƒ£ Test Database Connection (Optional):"
echo "   â†’ Set DATABASE_URL in your local .env.local"
echo "   â†’ Run: npx prisma db pull"
echo "   â†’ This will test the connection and sync your schema"
echo ""

echo "5ï¸âƒ£ Deploy and Test:"
echo "   â†’ Push to main branch"
echo "   â†’ Deployment will run database migrations automatically"
echo "   â†’ Check deployment logs for success"
echo ""

echo "ğŸ”§ Troubleshooting:"
echo "   â†’ If migrations fail: Check DATABASE_URL format and SSL settings"
echo "   â†’ If connection fails: Verify Neon database is active (not suspended)"
echo "   â†’ If SSL errors: Ensure ?sslmode=require is in connection string"
echo "   â†’ If timeout: Neon databases auto-suspend, first query may be slower"
echo ""

echo "ğŸ“š Neon Connection String Format:"
echo "   Standard format:"
echo "   postgresql://username:password@ep-xxx-xxx.region.aws.neon.tech/database?sslmode=require"
echo ""
echo "   With connection pooling (recommended for production):"
echo "   postgresql://username:password@ep-xxx-xxx-pooler.region.aws.neon.tech/database?sslmode=require"
echo ""

echo "ğŸŒŸ Neon PostgreSQL Benefits:"
echo "   â†’ Serverless: Auto-scaling and auto-suspend"
echo "   â†’ Branching: Database branches like Git branches"
echo "   â†’ Fast: Sub-second cold starts"
echo "   â†’ Cost-effective: Pay only for what you use"
echo "   â†’ Prisma optimized: Built for modern development"
echo ""

echo "âœ… Once complete, your production app will have:"
echo "   â†’ Working Neon PostgreSQL connections"
echo "   â†’ Automatic migrations on deployment"
echo "   â†’ Serverless database scaling"
echo "   â†’ Full authentication and data persistence"
echo "   â†’ Database branching for staging/production"
echo ""

echo "ğŸš€ Ready to set up your Neon production database!"
